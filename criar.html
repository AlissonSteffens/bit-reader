<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Image 2 Bin</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' media='screen' href='main.css'>
    <script src='main.js'></script>
</head>
<body>
    <div class="inicio">
        <textarea name="" id="image"></textarea>
        <button onclick="create_image()">Fazer Imagem</button>
    </div>

    <div id= "file-js">

        <input type = "file" name="resume"></input>

    </div>
    
    <canvas id="myCanvas" width="800" height="600"></canvas>
    <script>
        var pixelsize = 10
        // convert 0..255 R,G,B values to a hexidecimal color string
        RGBToHex = function(r,g,b){
            var bin = r << 16 | g << 8 | b;
            return (function(h){
                return new Array(7-h.length).join("0")+h
            })(bin.toString(16).toUpperCase())
        }

        // convert a 24 bit binary color to 0..255 R,G,B
        binToRGB = function(bin){
            var pbin = parseInt(bin,2);
            var r = pbin >> 16;
            var g = pbin >> 8 & 0xFF;
            var b = pbin & 0xFF;
            return [r,g,b];
        }

        // convert a hexidecimal color string to 0..255 R,G,B
        hexToRGB = function(hex){
            var r = hex >> 16;
            var g = hex >> 8 & 0xFF;
            var b = hex & 0xFF;
            return [r,g,b];
        }
        function create_image(){
            var bin = document.getElementById("image").value;
            let linhas = bin.split("\n")
            canvas = document.getElementById('myCanvas')
            canvasContext = canvas.getContext('2d')
            var i,j = 0
            linhas.forEach(element => {
                colunas = element.split(',')
                colunas.pop()
                i=0
                colunas.forEach(ef => {
                    arr = binToRGB(ef)
                    let r = arr[0]
                    let g = arr[1]
                    let b = arr[2]
                    canvasContext.fillStyle = '#'+RGBToHex(r,g,b)
                    canvasContext.fillRect(i*pixelsize,j*pixelsize,pixelsize, pixelsize)
                    i++
                });
                j++
            });
        }


// Check for the File API support.
    if (window.File && window.FileReader && window.FileList && window.Blob) {
      document.querySelector('#file-js input[type=file]').addEventListener('change', handleFileSelect, false);
      
    } else {
      // alert('The File APIs are not fully supported in this browser.');
    }

    var BASE64_MARKER;
    function handleFileSelect(evt) {
      var f = evt.target.files[0]; // FileList object
      var reader = new FileReader();
      // Closure to capture the file information.
      reader.onload = (function(theFile) {
        return function(e) {
          var binaryData = e.target.result;
          //Converting Binary Data to base 64
          var base64String = window.btoa(binaryData);
          //showing file converted to base64
          // document.getElementById('base64').value = base64String;
          // alert('File converted to base64 successfuly!\nCheck in Textarea');
          BASE64_MARKER = base64String
        };
      })(f);
      // Read in the image file as a data URL.
      reader.readAsBinaryString(f);
    }
    

function convertDataURIToBinary(dataURI) {
  var base64Index = dataURI.indexOf(BASE64_MARKER) + BASE64_MARKER.length;
  var base64 = dataURI.substring(base64Index);
  var raw = window.atob(base64);
  var rawLength = raw.length;
  var array = new Uint8Array(new ArrayBuffer(rawLength));

  for(i = 0; i < rawLength; i++) {
    array[i] = raw.charCodeAt(i);
  }
  return array;
  console.log(array);
}

  
    </script>
</body>
</html>